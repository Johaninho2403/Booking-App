// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id         String      @id @default(auto()) @map("_id") @db.ObjectId
  username   String
  email      String      @unique
  password   String
  avatar     String?     @default("")
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @default(now()) @updatedAt
  posts      Post[]
  savedPosts SavedPost[]
  chats      Chat[]      @relation(fields: [chatsId], references: [id])
  chatsId    String[]    @db.ObjectId
  messages   Message[]
}

model Post {
  id          String      @id @default(auto()) @map("_id") @db.ObjectId
  title       String
  description String
  price       Float
  images      String[]
  adress      String
  city        String
  bedroom     Int
  bathroom    Int
  longitude   Float
  latitude    Float
  utilities   String?
  pet         String?
  income      String?
  school      String?
  bus         String?
  restaurant  String?
  size        Int?
  type        Type
  property    Property
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @default(now()) @updatedAt
  userId      String      @db.ObjectId
  user        User        @relation(fields: [userId], references: [id])
  savedPosts  SavedPost[]
}

model SavedPost {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String   @db.ObjectId
  postId    String   @db.ObjectId
  user      User     @relation(fields: [userId], references: [id])
  post      Post     @relation(fields: [postId], references: [id])
  createdAt DateTime @default(now())

  @@unique([userId, postId])
}

model Chat {
  id            String    @id @default(auto()) @map("_id") @db.ObjectId
  usersId       String[]  @db.ObjectId
  users         User[]    @relation(fields: [usersId], references: [id])
  seenBy        String[]   @db.ObjectId
  createdAt     DateTime  @default(now())
  messages      Message[]
  lastMessage String?
}

model Message {
  id     String @id @default(auto()) @map("_id") @db.ObjectId
  text   String
  userId String @db.ObjectId
  user   User   @relation(fields: [userId], references: [id])
  chatId String @db.ObjectId
  chat   Chat   @relation(fields: [chatId], references: [id])
  createdAt DateTime @default(now())
}

enum Type {
  buy
  rent
}

enum Property {
  apartment
  house
  condo
  land
}
